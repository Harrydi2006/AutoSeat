# 智能座位分配系统

🪑 一个基于约束优化算法的智能座位分配系统，根据人员间的喜好关系自动生成最优座位方案。

## ✨ 功能特性

- 🧠 **智能优化算法**：基于 OR-Tools 约束求解器，确保最优解
- 📊 **多种数据输入**：支持 Excel 文件导入和手动输入
- 🎨 **可视化结果**：直观的座位分配图和关系线显示
- 📈 **详细统计分析**：满足度、目标函数值等多维度分析
- 📥 **多格式导出**：支持 Excel 表格和 PNG 图片导出
- 🏫 **灵活布局**：支持不规则教室布局配置
- 🔄 **多方案生成**：一次计算生成多个备选方案

## 🚀 快速开始

### 环境要求

- Python 3.8+
- 推荐使用虚拟环境

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行应用

```bash
streamlit run app.py
```

应用将在浏览器中自动打开，默认地址：http://localhost:8501

## 📋 使用指南

### 1. 数据准备

#### 人员名单 Excel 格式
- 默认读取第一列的所有非空值作为姓名
- 支持自定义列范围，如 "A:A" 或 "B:B"

示例：
```
| 姓名   |
|--------|
| 张三   |
| 李四   |
| 王五   |
| 赵六   |
```

#### 喜好关系 Excel 格式
- 支持多个优先级的喜好关系
- 喜欢坐一起的关系放在指定区域（如 A1:B10）
- 不喜欢坐一起的关系放在另一区域（如 D1:E10）

示例：
```
| 喜欢坐一起 |        | | 不喜欢坐一起 |        |
|------------|--------|-|--------------|--------|
| 张三       | 李四   | | 王五         | 赵六   |
| 李四       | 王五   | | 张三         | 赵六   |
```

### 2. 系统配置

#### 权重设置
- **喜好权重 1-3**：对应不同优先级的喜好关系权重
- **不喜好权重 1-3**：对应不同优先级的不喜好关系权重
- 建议范围：1-10，数值越大影响越大

#### 教室布局
- **列数**：教室的列数（1-15）
- **每列排数**：每列的座位排数，支持不规则布局
- **对角线邻座**：是否将对角线方向视为邻座关系

#### 计算参数
- **生成方案数**：一次计算生成的备选方案数量（1-10）
- **时间限制**：每个方案的最大计算时间（1-60秒）

### 3. 操作流程

1. **上传数据**：在侧边栏上传人员名单和喜好关系文件
2. **设置权重**：调整各级别喜好关系的权重
3. **配置布局**：设置教室的列数和排数
4. **预览数据**：在"数据预览"标签页检查导入的数据
5. **计算方案**：点击"计算最优座位分配"按钮
6. **查看结果**：在"结果查看"标签页查看生成的方案
7. **导出结果**：下载 Excel 座位表或 PNG 分配图

## 🔧 技术架构

### 核心技术栈
- **前端框架**：Streamlit
- **优化引擎**：OR-Tools (Google)
- **数据处理**：Pandas, NumPy
- **可视化**：Matplotlib
- **文件处理**：OpenPyXL

### 算法原理

系统采用约束满足问题（CSP）建模：

1. **决策变量**：每个人分配到每个座位的二进制变量
2. **约束条件**：
   - 每人分配一个座位
   - 每座位最多分配一人
3. **目标函数**：最大化相邻座位上有正向关系的人员对的权重和
4. **求解器**：使用 CP-SAT 求解器寻找最优解

### 项目结构

```
分座位trae/
├── app.py                 # 主应用程序
├── requirements.txt       # 依赖包列表
├── README.md             # 项目文档
├── .streamlit/
│   └── config.toml       # Streamlit 配置
└── 我现在有一段代码，实现了如下功能.ini  # 原始代码文件
```

## 📊 性能指标

### 满足度计算
- **满足率**：有喜好关系且被满足的人数占总有喜好关系人数的百分比
- **满足对数**：成功安排在相邻座位的喜好关系对数
- **目标函数值**：所有相邻关系权重的加权和

### 优化建议
- 座位数量应略大于人数，留有调整空间
- 权重设置要合理，避免过大的权重差异
- 对于大规模问题，可适当增加计算时间限制

## 🐛 常见问题

### Q: 计算结果满足率较低怎么办？
A: 可能的解决方案：
- 增加座位数量
- 调整权重设置，降低冲突关系的权重
- 检查喜好关系是否存在过多冲突
- 增加计算时间限制

### Q: 支持多大规模的问题？
A: 建议规模：
- 人数：≤ 100 人
- 座位数：≤ 120 个
- 关系对数：≤ 200 对

### Q: 如何处理特殊需求？
A: 可以通过以下方式：
- 使用自定义权重功能添加特殊关系
- 调整座位布局以适应特殊要求
- 在多个生成的方案中选择最合适的

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发环境设置

```bash
# 克隆项目
git clone <repository-url>
cd 分座位trae

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 运行应用
streamlit run app.py
```

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

## 🙏 致谢

- [Streamlit](https://streamlit.io/) - 优秀的 Python Web 应用框架
- [OR-Tools](https://developers.google.com/optimization) - Google 的优化工具包
- [Pandas](https://pandas.pydata.org/) - 强大的数据处理库

---

**🪑 让每个人都有合适的位置！**